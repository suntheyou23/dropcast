# 要件定義書

## 概要

DropCastは、Raindrop.ioと連携してブックマークを自動収集し、週次でダイジェストメールを送信する自動化システムです。開発チーム内でのニュース記事や参考情報の共有プロセスを効率化し、週間で保存されたブックマークの収集、フォーマット、配信を自動化することを目的としています。

## 要件

### 要件1

**ユーザーストーリー:** チームメンバーとして、Raindrop.ioに保存したブックマークの週次ダイジェストメールを自動で受信したい。手動作業なしに関連情報をレビューし共有できるようにするため。

#### 受入基準

1. システムが週次スケジュールで実行される時、Raindrop.io APIから過去7日間に保存されたすべてのブックマークを取得すること
2. ブックマークが取得される時、各ブックマークのURL、タイトル、フォルダ名、お気に入りフラグを含むこと
3. ダイジェストが準備される時、コンテンツをRedmine用マークダウン形式でフォーマットすること
4. メールの準備が完了した時、AWS SESを使用して設定されたメールアドレスに送信すること

### 要件2

**ユーザーストーリー:** システム管理者として、ブックマーク収集が毎週自動で実行されることを望む。ダイジェスト配信が一貫して信頼できるものにするため。

#### 受入基準

1. 毎週木曜日の午前0時になった時、システムはブックマーク収集プロセスを自動でトリガーすること
2. スケジュール実行が開始される時、AWS EventBridgeをトリガーメカニズムとして使用すること
3. 実行が失敗した場合、システムはエラー詳細をCloudWatch Logsに記録すること
4. プロセスが正常に完了した時、システムは完了ステータスをCloudWatch Logsに記録すること

### 要件3

**ユーザーストーリー:** コストを意識するユーザーとして、システムが無料枠内で動作することを望む。料金を発生させることなく使用できるようにするため。

#### 受入基準

1. Raindrop.io APIを使用する時、システムは無料枠のAPI制限内に留まること
2. AWSサービスを使用する時、Lambda、EventBridge、SES、CloudWatchの無料枠を活用すること

### 要件4

**ユーザーストーリー:** 開発者として、システムがシンプルで保守しやすいことを望む。必要に応じて簡単に修正やトラブルシューティングができるようにするため。

#### 受入基準

1. システムを実装する時、プログラミング言語としてNode.jsを使用すること
2. コードを構造化する時、不必要な複雑さを避けてシンプルで読みやすいパターンに従うこと
3. エラーが発生した時、システムは明確なエラーメッセージとログを提供すること
4. 設定が必要な時、APIキーやメールアドレスなどの機密データには環境変数を使用すること
5. インフラストラクチャを管理する時、AWS CDK (TypeScript)を使用してコードとして管理すること

### 要件5

**ユーザーストーリー:** ユーザーとして、メールダイジェストが適切にフォーマットされ読みやすいことを望む。保存したブックマークを素早くスキャンできるようにするため。

#### 受入基準

1. メールをフォーマットする時、システムはブックマークをフォルダ名で整理すること
2. フォルダ名を表示する時、「h4. [フォルダ名]」の形式を使用すること
3. 各ブックマークを表示する時、「* "[タイトル]":[URL]」の形式を使用すること
4. お気に入りブックマークの場合、URL の後に「 %{color: red}★%」を追加すること
5. メールが送信される時、最大限の互換性のためプレーンテキスト形式を使用すること
6. ブックマークが見つからない場合、システムはその週に新しいブックマークがないことを通知すること

#### フォーマット例

```
h4. [生成AI]
* "spec-workflow-mcpとは?":https://example.com
* "話題のSerenaを使ってみた":https://example.com %{color: red}★%

h4. [コーディング]
* "短いコードは本当に正しいのか":https://example.com
```
